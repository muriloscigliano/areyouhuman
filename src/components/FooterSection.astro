---
// Footer with parallax effect
import FluidText from './FluidText.astro';
---

<div data-footer-parallax class="footer-wrap">
  <footer data-footer-parallax-inner class="footer-section">
    <!-- Fluid canvas as full background -->
    <div class="footer-fluid-bg">
      <FluidText
        text={"AI studio for human advantage\nARE YOU\nHUMAN?"}
        fontSize={220}
        fontFamily="PP Neue Machina"
        isBold={true}
        color={{ r: 0.75, g: 0.75, b: 0.75 }}
        bgColor={{ r: 1, g: 1, b: 1 }}
        class="footer-fluid-text"
      />
    </div>

    <!-- Links overlay on top -->
    <div class="footer-section__links-row">
      <div class="footer-section__col">
        <p class="footer-eyebrow">( Pages )</p>
        <div class="footer-section__links">
          <a data-underline-link href="#hero" class="footer-section__a">Home</a>
          <a data-underline-link href="#what-we-do" class="footer-section__a">What We Do</a>
          <a data-underline-link href="#framework" class="footer-section__a">Framework</a>
          <a data-underline-link href="#what-we-build" class="footer-section__a">What We Build</a>
        </div>
      </div>

      <div class="footer-section__col">
        <p class="footer-eyebrow">( Contact )</p>
        <div class="footer-section__links">
          <a data-underline-link href="mailto:contact@areyouhuman.com" class="footer-section__a">contact@areyouhuman.com</a>
          <a data-underline-link href="#" class="footer-section__a">Start a Conversation</a>
        </div>
      </div>

      <div class="footer-section__col">
        <p class="footer-eyebrow">( Philosophy )</p>
        <div class="footer-section__links">
          <a data-underline-link href="#" class="footer-section__a">Human-First AI</a>
          <a data-underline-link href="#" class="footer-section__a">The Human Advantage</a>
          <a data-underline-link href="#" class="footer-section__a">Stay Human. Stay Ahead.</a>
        </div>
      </div>
    </div>

    <!-- Bottom bar anchored at bottom -->
    <div class="footer-bottom">
      <p class="footer-copyright">Â© 2025 Are You Human? All rights reserved.</p>
      <p class="footer-tagline">Stay Human. Stay Ahead.</p>
    </div>
  </footer>

  <div data-footer-parallax-dark class="footer-wrap__dark"></div>
</div>

<script>
  if (typeof window !== 'undefined') {
    (async () => {
      const { gsap } = await import("gsap");
      // @ts-ignore
      const ScrollTriggerModule = await import("gsap/ScrollTrigger.js");
      const ScrollTrigger = ScrollTriggerModule.default;

      gsap.registerPlugin(ScrollTrigger);

      // Wait for intro animation to complete
      await new Promise((resolve) => {
        const checkIntroComplete = () => {
          const mainContent = document.getElementById('main-content');
          if (mainContent && !mainContent.classList.contains('landing--hidden')) {
            resolve(undefined);
          } else {
            window.addEventListener('intro-complete', () => {
              setTimeout(() => resolve(undefined), 500);
            }, { once: true });
          }
        };
        checkIntroComplete();
      });

      await new Promise(resolve => setTimeout(resolve, 300));

      function initFooterParallax() {
        document.querySelectorAll('[data-footer-parallax]').forEach((el) => {
          const tl = gsap.timeline({
            scrollTrigger: {
              trigger: el,
              start: 'clamp(top bottom)',
              end: 'clamp(top top)',
              scrub: true
            }
          });

          const inner = el.querySelector('[data-footer-parallax-inner]');
          const dark = el.querySelector('[data-footer-parallax-dark]');

          if (inner) {
            tl.from(inner, {
              yPercent: -75,
              scale: 0.9,
              ease: 'linear'
            });
            tl.to(inner, {
              scale: 1,
              ease: 'linear'
            }, '<');
          }

          if (dark) {
            tl.from(dark, {
              ease: 'linear'
            }, '<');
          }
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(initFooterParallax, 800);
        });
      } else {
        setTimeout(initFooterParallax, 800);
      }
    })();
  }
</script>

<style>
.footer-wrap {
  position: relative;
  overflow: hidden;
  background: #ffffff;
  z-index: 10;
}

.footer-section {
  letter-spacing: -.02em;
  min-height: 100svh; /* At least full viewport - best practice */
  min-height: 100dvh; /* Dynamic viewport height for mobile */
  padding: 0;
  font-weight: 600;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  background: transparent;
  color: #000000;
}

/* Fluid canvas covers entire footer */
.footer-fluid-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}

.footer-fluid-text {
  width: 100%;
  height: 100%;
}

/* Links overlay on top */
.footer-section__links-row {
  position: relative;
  z-index: 2;
  grid-column-gap: 2.5em;
  grid-row-gap: 2.5em;
  display: flex;
  padding: 2.5em;
  pointer-events: auto;
}

.footer-section__col {
  grid-column-gap: 3em;
  grid-row-gap: 3em;
  flex-flow: column;
  width: calc(33.3333% - 1.66667em);
  display: flex;
}

.footer-section__links {
  grid-column-gap: .25em;
  grid-row-gap: .25em;
  flex-flow: column;
  align-items: flex-start;
  display: flex;
}

.footer-section__a {
  color: inherit;
  font-family: 'PP Neue Machina', sans-serif;
  font-size: 2.75em;
  line-height: 1;
  text-decoration: none;
  font-weight: 400;
}

.footer-eyebrow {
  color: #d3d3d3;
  margin-bottom: 0;
  font-family: 'PP Neue Machina', sans-serif;
  font-size: 1.3125em;
  font-weight: 600;
}

/* Bottom bar */
.footer-bottom {
  position: relative;
  z-index: 2;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2.5em;
  pointer-events: auto;
  margin-top: auto;
}

.footer-copyright,
.footer-tagline {
  font-family: 'PP Neue Machina', sans-serif;
  font-size: 0.875em;
  font-weight: 400;
  color: #a0a0a0;
  margin: 0;
}

.footer-wrap__dark {
  opacity: 0;
  pointer-events: none;
  background-color: #201d1d;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

[data-underline-link] {
  text-decoration: none;
  position: relative;
}

[data-underline-link]::before {
  content: "";
  position: absolute;
  bottom: -0.0625em;
  left: 0;
  width: 100%;
  height: 0.1em;
  background-color: currentColor;
  transition: transform 0.735s cubic-bezier(0.625, 0.05, 0, 1);
  transform-origin: right;
  transform: scaleX(0) rotate(0.001deg);
}

@media (hover: hover) and (pointer: fine) {
  [data-underline-link]:hover::before {
    transform-origin: left;
    transform: scaleX(1) rotate(0.001deg);
  }
}

@media screen and (max-width: 991px) {
  .footer-section__links-row {
    flex-flow: column;
  }

  .footer-section__col {
    width: 100%;
  }
}

@media screen and (max-width: 767px) {
  .footer-eyebrow {
    font-size: 1em;
  }

  .footer-section__links-row {
    padding: 1.5em;
  }

  .footer-section__col {
    grid-column-gap: 1em;
    grid-row-gap: 1em;
  }

  .footer-section__a {
    font-size: 1.75em;
  }

  .footer-bottom {
    flex-direction: column;
    gap: 0.5em;
    text-align: center;
    padding: 1.5em;
  }
}
</style>
